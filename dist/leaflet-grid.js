!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e(require("leaflet"),require("leaflet-canvas-layer"),require("d3-timer"),require("chroma-js"),require("d3-array"),require("geotiff"),require("d3-scale"),require("d3-selection"));else if("function"==typeof define&&define.amd)define(["leaflet","leaflet-canvas-layer","d3-timer","chroma-js","d3-array","geotiff","d3-scale","d3-selection"],e);else{var a="object"==typeof exports?e(require("leaflet"),require("leaflet-canvas-layer"),require("d3-timer"),require("chroma-js"),require("d3-array"),require("geotiff"),require("d3-scale"),require("d3-selection")):e(t.leaflet,t["leaflet-canvas-layer"],t["d3-timer"],t["chroma-js"],t["d3-array"],t.geotiff,t["d3-scale"],t["d3-selection"]);for(var o in a)("object"==typeof exports?exports:t)[o]=a[o]}}(this,function(t,e,a,o,r,n,i,l){return function(t){function __webpack_require__(a){if(e[a])return e[a].exports;var o=e[a]={i:a,l:!1,exports:{}};return t[a].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}var e={};return __webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,a){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:a})},__webpack_require__.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=8)}([function(e,a){e.exports=t},function(t,e){t.exports=r},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a(0),r=function(){function Celda(t,e,a){this._center=t,this._value=e,this._size=a}return Object.defineProperty(Celda.prototype,"center",{get:function(){return this._center},set:function(t){this._center=t},enumerable:!0,configurable:!0}),Object.defineProperty(Celda.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t},enumerable:!0,configurable:!0}),Celda.prototype.equals=function(t){return this.center.equals(t.center)&&this._equalValues(this.value,t.value)&&this._size===t._size},Celda.prototype.getBounds=function(){var t=[this._size.x/2,this._size.y/2],e=t[0],a=t[1],r=this.center.lat,n=this.center.lng,i=new o.LatLng(r+a,n-e),l=new o.LatLng(r-a,n+e);return o.latLngBounds(o.latLng(l.lat,i.lng),o.latLng(i.lat,l.lng))},Celda.prototype._equalValues=function(t,e){var a=t.constructor.name;return{number:t===e,Vector:t.u===e.u&&t.v===e.v}[a]},Celda}();e.Celda=r},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a(0),r=a(2),n=function(){function Malla(t){this.defMalla=t,this.grid=null,this.isContinuous=this.xurCorner-this.defMalla.xllCorner>=360,this.longitudeNeedsToBeWrapped=this.xurCorner>180,this._inFilter=null}return Object.defineProperty(Malla.prototype,"cellSize",{get:function(){return this.defMalla.cellSize},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"nCols",{get:function(){return this.defMalla.nCols},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"nRows",{get:function(){return this.defMalla.nRows},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"xllCorner",{get:function(){return this.defMalla.xllCorner},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"yllCorner",{get:function(){return this.defMalla.yllCorner},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"range",{get:function(){return this._range},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"height",{get:function(){return this.nRows},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"width",{get:function(){return this.nCols},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"xurCorner",{get:function(){return this.defMalla.xllCorner+this.defMalla.nCols*this.defMalla.cellSize.x},enumerable:!0,configurable:!0}),Object.defineProperty(Malla.prototype,"yurCorner",{get:function(){return this.defMalla.yllCorner+this.defMalla.nRows*this.defMalla.cellSize.y},enumerable:!0,configurable:!0}),Malla.prototype.numCells=function(){return this.defMalla.nRows*this.defMalla.nCols},Malla.prototype.getBounds=function(){return new o.LatLngBounds([[this.defMalla.yllCorner,this.defMalla.xllCorner],[this.yurCorner,this.xurCorner]])},Malla.prototype.getCells=function(t){void 0===t&&(t=1);for(var e=[],a=0;a<this.defMalla.nRows;a+=t)for(var n=0;n<this.defMalla.nCols;n+=t){var i=this.lonLatAtIndexes(n,a),l=i[0],s=i[1],c=new o.LatLng(s,l),u=this._valueAtIndexes(n,a),p=new r.Celda(c,u,this.defMalla.cellSize);e.push(p)}return e},Malla.prototype.setFilter=function(t){this._inFilter=t,this._updateRange()},Malla.prototype.extent=function(){var t=this._getWrappedLongitudes(),e=t[0],a=t[1];return[e,this.defMalla.yllCorner,a,this.yurCorner]},Malla.prototype.contains=function(t,e){var a=this._getWrappedLongitudes(),o=a[0],r=a[1],n=t>=o&&t<=r,i=e>=this.defMalla.yllCorner&&e<=this.yurCorner;return n&&i},Malla.prototype.valueAt=function(t,e){if(this.notContains(t,e))return null;var a=this._getDecimalIndexes(t,e),o=a[0],r=a[1],n=Math.floor(o),i=Math.floor(r),l=this._valueAtIndexes(n,i);return this._inFilter&&!this._inFilter(l)?null:l},Malla.prototype.notContains=function(t,e){return!this.contains(t,e)},Malla.prototype.interpolatedValueAt=function(t,e){if(this.notContains(t,e))return null;var a=this._getDecimalIndexes(t,e),o=a[0],r=a[1];return this.interpolatedValueAtIndexes(o,r)},Malla.prototype.interpolatedValueAtIndexes=function(t,e){var a=this._getFourSurroundingIndexes(t,e),o=a[0],r=a[1],n=a[2],i=a[3],l=this._getFourSurroundingValues(o,r,n,i);if(l){var s=l[0],c=l[1],u=l[2],p=l[3];return this._doInterpolation(t-o,e-n,s,c,u,p)}return null},Malla.prototype.hasValueAt=function(t,e){var a=this.valueAt(t,e),o=null!==a,r=!0;return this._inFilter&&(r=this._inFilter(a)),o&&r},Malla.prototype.randomPosition=function(t){var e=Math.random()*this.defMalla.nCols||0,a=Math.random()*this.defMalla.nRows||0,o={x:0,y:0};return o.x=this._longitudeAtX(e),o.y=this._latitudeAtY(a),t&&(t.x=o.x,t.y=o.y),o},Malla.prototype.lonLatAtIndexes=function(t,e){return[this._longitudeAtX(t),this._latitudeAtY(e)]},Malla.prototype._updateRange=function(){this._range=this._calculateRange()},Malla.prototype._isValid=function(t){return null!==t&&void 0!==t},Malla.prototype._getWrappedLongitudes=function(){var t=this.defMalla.xllCorner,e=this.xurCorner;return this.longitudeNeedsToBeWrapped&&(this.isContinuous?(t=-180,e=180):(e=this.xurCorner-360,t=this.defMalla.xllCorner-360)),[t,e]},Malla.prototype._getDecimalIndexes=function(t,e){this.longitudeNeedsToBeWrapped&&t<0&&(t+=360);var a=(t-this.defMalla.xllCorner)/this.defMalla.cellSize.x,o=this._clampColumnIndex(a),r=(this.yurCorner-e)/this.defMalla.cellSize.y;return[o,this._clampRowIndex(r)]},Malla.prototype._getFourSurroundingIndexes=function(t,e){var a=this._clampColumnIndex(Math.floor(t)),o=this._clampColumnIndex(a+1),r=this._clampRowIndex(Math.floor(e));return[a,o,r,this._clampRowIndex(r+1)]},Malla.prototype._getFourSurroundingValues=function(t,e,a,o){var r=this.grid[a];if(r){var n=r[t],i=r[e];if(r=this.grid[o],this._isValid(n)&&this._isValid(i)&&r){var l=r[t],s=r[e];if(this._isValid(l)&&this._isValid(s))return[n,i,l,s]}}return null},Malla.prototype._valueAtIndexes=function(t,e){return this.grid[e][t]},Malla.prototype._longitudeAtX=function(t){var e=this.defMalla.cellSize.x/2,a=this.defMalla.xllCorner+e+t*this.defMalla.cellSize.x;return this.longitudeNeedsToBeWrapped&&(a=a>180?a-360:a),a},Malla.prototype._latitudeAtY=function(t){var e=this.defMalla.cellSize.y/2;return this.yurCorner-e-t*this.defMalla.cellSize.y},Malla.prototype._clampColumnIndex=function(t){var e=t;t<0&&(e=0);var a=this.defMalla.nCols-1;return t>a&&(e=this.isContinuous?0:a),e},Malla.prototype._clampRowIndex=function(t){var e=t;t<0&&(e=0);var a=this.defMalla.nRows-1;return t>a&&(e=a),e},Malla}();e.Malla=n},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=a(1),n=a(3),i=a(12),l=function(t){function MallaEscalar(e){var a=t.call(this,e)||this;return a._zs=e.zs,a.grid=a._buildGrid(),a._updateRange(),a}return o(MallaEscalar,t),MallaEscalar.fromData=function(t,e,a){void 0===a&&(a="c");var o=e.map(function(t){return t[a]}),r=t;return r.zs=o,new MallaEscalar(r)},MallaEscalar.fromASCIIGrid=function(t,e){void 0===e&&(e=1);var a=t.split("\n");MallaEscalar._checkIsValidASCIIGridHeader(a);for(var o=/-?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/,r={cellSize:{x:parseFloat(a[4].match(o).toString()),y:parseFloat(a[4].match(o).toString())},nCols:parseInt(a[0].match(o).toString(),10),nRows:parseInt(a[1].match(o).toString(),10),xllCorner:parseFloat(a[2].match(o).toString()),yllCorner:parseFloat(a[3].match(o).toString())},n=a[5].toUpperCase().replace("NODATA_VALUE","").trim(),i=[],l=6;l<a.length;l++){var s=a[l].trim();if(""===s)break;var c=s.split(" "),u=c.map(function(t){return t!==n?parseFloat(t)*e:null});i.push.apply(i,u)}return r.zs=i,new MallaEscalar(r)},MallaEscalar.fromGeoTIFF=function(t,e){void 0===e&&(e=0);var a=i.GeoTIFF.parse(t),o=a.getImage(),r=o.readRasters(),n=o.getTiePoints()[0],l=o.getFileDirectory(),s=l.ModelPixelScale,c=s[0],u=s[1];if(c!==u)throw new Error("GeoTIFF with different scale in x: "+c+" y: "+u+" is not currently supported\n            \nMake sure the difference is just a floating precission issue");var p=r[e];if(l.GDAL_NODATA){var f=parseFloat(l.GDAL_NODATA);p=Array.from(p).map(function(t){return t===f?null:t})}return new MallaEscalar({cellSize:s[0],nCols:o.getWidth(),nRows:o.getHeight(),xllCorner:n.x,yllCorner:n.y-o.getHeight()*s[0],zs:p})},MallaEscalar._checkIsValidASCIIGridHeader=function(t){for(var e=t.map(function(t){return t.toUpperCase()}),a=["NCOLS","NROWS","XLLCORNER","YLLCORNER","CELLSIZE","NODATA_VALUE"],o=0,r=0,n=a;r<n.length;r++){var i=n[r],l=e[o];if(!(-1!==l.indexOf(i)))throw new Error("Not valid ASCIIGrid: expected '"+i+"' at line '"+l+"' [lin. nÂº "+o+"]");o++}},Object.defineProperty(MallaEscalar.prototype,"zs",{get:function(){return this._zs},enumerable:!0,configurable:!0}),MallaEscalar.prototype.updateData=function(t,e){var a=t.map(function(t){return t[e]});this._zs=a,this.grid=this._buildGrid(),this._updateRange()},MallaEscalar.prototype._buildGrid=function(){return this._arrayTo2d(this.zs,this.nRows,this.nCols)},MallaEscalar.prototype._calculateRange=function(){var t=this.zs;return this._inFilter&&(t=t.filter(this._inFilter)),[r.min(t),r.max(t)]},MallaEscalar.prototype._doInterpolation=function(t,e,a,o,r,n){var i=1-t,l=1-e;return a*i*l+o*t*l+r*i*e+n*t*e},MallaEscalar.prototype._arrayTo2d=function(t,e,a){for(var o=[],r=0,n=0;n<e;n++){for(var i=[],l=0;l<a;l++,r++){var s=t[r];i[l]=this._isValid(s)?s:null}o[n]=i}return o},MallaEscalar}(n.Malla);e.MallaEscalar=l},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function Vector(t,e){this._u=t,this._v=e}return Object.defineProperty(Vector.prototype,"u",{get:function(){return this._u},enumerable:!0,configurable:!0}),Object.defineProperty(Vector.prototype,"v",{get:function(){return this._v},enumerable:!0,configurable:!0}),Vector.prototype.magnitude=function(){return Math.sqrt(this.u*this.u+this.v*this.v)},Vector.prototype.directionTo=function(){var t=Math.atan2(this.u,this.v),e=t*(180/Math.PI);return e<0&&(e+=360),e},Vector.prototype.directionFrom=function(){return(this.directionTo()+180)%360},Vector}();e.Vector=o},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=a(0),n=a(7),i=function(t){function CanvasLayerMalla(e,a){var o=t.call(this,a)||this;return o._options={inFilter:o._inFilterO,mouseMoveCursor:{noValue:"default",value:"pointer"},onClick:o._onClick,onMouseMove:o._onMouseMoveO,opacity:1},r.Util.setOptions(o,a),o._visible=!0,o.setData(e),o}return o(CanvasLayerMalla,t),Object.defineProperty(CanvasLayerMalla.prototype,"options",{get:function(){return this._options},set:function(t){this._options=t},enumerable:!0,configurable:!0}),CanvasLayerMalla.prototype.getEvents=function(){return t.prototype.getEvents.call(this)},CanvasLayerMalla.prototype.onLayerDidMount=function(){this._ensureCanvasAlignment()},CanvasLayerMalla.prototype.isVisible=function(){return this._visible},CanvasLayerMalla.prototype.setData=function(t){t.setFilter(this.options.inFilter),this._malla=t,this.needRedraw(),this.fire("load")},CanvasLayerMalla.prototype.setFilter=function(t){this.options.inFilter=t,this._malla.setFilter(t),this.needRedraw()},CanvasLayerMalla.prototype.needRedraw=function(){return this._map&&this._malla&&t.prototype.needRedraw.call(this),this},CanvasLayerMalla.prototype.setOpacity=function(t){return this.options.opacity=t,this._canvas&&this._updateOpacity(),this},CanvasLayerMalla.prototype.getBounds=function(){var t=this._malla.extent(),e=new r.LatLng(t[1],t[0]),a=new r.LatLng(t[3],t[2]);return new r.LatLngBounds(e,a)},CanvasLayerMalla.prototype.show=function(){this._visible=!0,this._showCanvas()},CanvasLayerMalla.prototype.hide=function(){this._visible=!1,this._hideCanvas()},CanvasLayerMalla.prototype._updateOpacity=function(){r.DomUtil.setOpacity(this._canvas,this.options.opacity)},CanvasLayerMalla.prototype._showCanvas=function(){this._canvas&&this._visible&&(this._canvas.style.visibility="visible")},CanvasLayerMalla.prototype._getDrawingContext=function(){var t=this._canvas.getContext("2d");return t.clearRect(0,0,this._canvas.width,this._canvas.height),t},CanvasLayerMalla.prototype._onClick=function(t){var e=this._queryValue(t);this.fire("click",e)},CanvasLayerMalla.prototype._onMouseMove=function(t){var e=this._queryValue(t);this._changeCursorOn(e),this.fire("mousemove",e)},CanvasLayerMalla.prototype.onLayerWillUnmount=function(){},CanvasLayerMalla.prototype._hideCanvas=function(){this._canvas&&(this._canvas.style.visibility="hidden")},CanvasLayerMalla.prototype._ensureCanvasAlignment=function(){var t=this._map.containerPointToLayerPoint([0,0]);r.DomUtil.setPosition(this._canvas,t)},CanvasLayerMalla.prototype._changeCursorOn=function(t){if(this.options.mouseMoveCursor){var e=this.options.mouseMoveCursor,a=e.value,o=e.noValue;this._map.getContainer().style.cursor=null!==t.value?a:o}},CanvasLayerMalla.prototype._queryValue=function(t){var e=this._malla?this._malla.valueAt(t.latlng.lng,t.latlng.lat):null;return{latlng:t.latlng,value:e}},CanvasLayerMalla}(n.CanvasLayer);e.CanvasLayerMalla=i},function(t,a){t.exports=e},function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),a(9),a(2),a(3),a(4),a(13),a(5),a(14),a(17),a(19)},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=a(1),n=a(10),i=a(11),l=a(0),s=function(t){function ColorBar(e,a,o){var r=t.call(this)||this;return r.options={background:"#fff",decimals:2,height:20,labelFontSize:12,labels:[],labelTextPosition:"middle",margin:15,position:"bottomright",steps:100,textColor:"black",title:"Legend",units:"uds",width:300},r._color=e,r._range=a,l.Util.setOptions(r,o),r}return o(ColorBar,t),ColorBar.prototype.onAdd=function(t){this._map=t;var e=l.DomUtil.create("div","leaflet-control-colorBar leaflet-bar leaflet-control");return e.style.padding="10px",l.DomEvent.addListener(e,"click",l.DomEvent.stopPropagation).addListener(e,"click",l.DomEvent.preventDefault),e.style.backgroundColor=this.options.background,e.style.cursor="pointer",e.innerHTML=this.title()+this.palette(),e},ColorBar.prototype.title=function(){var t=document.createElement("div");return i.select(t).append("span").style("color",this.options.textColor).style("display","block").style("margin-bottom","5px").style("font-size","15px").style("font-weight","bold").attr("class","leaflet-control-colorBar-title").text(this.options.title+" ("+this.options.units+")"),t.innerHTML},ColorBar.prototype.palette=function(){var t=document.createElement("div"),e=this._createSvgIn(t);return this._appendColorBarTo(e),this.options.labels&&this._appendLabelsTo(e),t.innerHTML},ColorBar.prototype._createSvgIn=function(t){var e=this.options.labels?this.options.margin:0;return i.select(t).append("svg").attr("width",this.options.width+2*this.options.margin).attr("height",this.options.height+e)},ColorBar.prototype._appendColorBarTo=function(t){var e=this,a=this._getColorPerValue(),o=this.options.width/a.length,r=t.append("g").attr("id","colorBar-buckets"),n=r.selectAll("rect").data(a).enter().append("rect");n.attr("x",function(t,a){return a*o+e.options.margin}).attr("y",function(){return 0}).attr("height",function(){return e.options.height}).attr("width",function(){return o}).attr("stroke-width",2).attr("stroke-linecap","butt").attr("stroke",function(t){return t.color.hex()}).attr("fill",function(t){return t.color.hex()}),n.append("title").text(function(t){return t.value.toFixed(e.options.decimals)+" "+e.options.units})},ColorBar.prototype._appendLabelsTo=function(t){var e=this,a=this._getPositionPerLabelValue();t.append("g").attr("id","colorBar-labels").selectAll("text").data(a).enter().append("text").attr("x",function(t){return t.position+e.options.margin}).attr("y",this.options.height+this.options.margin).attr("font-size",this.options.labelFontSize+"px").attr("text-anchor",this.options.labelTextPosition).attr("fill",this.options.textColor).attr("class","leaflet-control-colorBar-label").text(function(t){return""+t.value.toFixed(e.options.decimals)})},ColorBar.prototype._getColorPerValue=function(){var t=this,e=this._range,a=e[0],o=e[1],n=(o-a)/this.options.steps;return r.range(a,o+n,n).map(function(e){return{color:t._color(e),value:e}})},ColorBar.prototype._getPositionPerLabelValue=function(){var t=n.scaleLinear().range([0,this.options.width]).domain(this._range);return this.options.labels.map(function(e){return{position:t(e),value:e}})},ColorBar}(l.Control);e.ColorBar=s},function(t,e){t.exports=i},function(t,e){t.exports=l},function(t,e){t.exports=n},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=a(1),n=a(3),i=a(4),l=a(5),s=function(t){function MallaVectorial(e){var a=t.call(this,e)||this;return a.us=e.us,a.vs=e.vs,a.grid=a._buildGrid(),a._range=a._calculateRange(),a}return o(MallaVectorial,t),MallaVectorial.fromMallas=function(t,e){return new MallaVectorial(MallaVectorial._paramsFromScalarFields(t,e))},MallaVectorial.fromASCIIGrids=function(t,e,a){void 0===a&&(a=1);var o=i.MallaEscalar.fromASCIIGrid(t,a),r=i.MallaEscalar.fromASCIIGrid(e,a);return new MallaVectorial(MallaVectorial._paramsFromScalarFields(o,r))},MallaVectorial.fromGeoTIFFs=function(t,e){var a=i.MallaEscalar.fromGeoTIFF(t),o=i.MallaEscalar.fromGeoTIFF(e);return new MallaVectorial(MallaVectorial._paramsFromScalarFields(a,o))},MallaVectorial.fromMultibandGeoTIFF=function(t,e){void 0===e&&(e=[0,1]);var a=i.MallaEscalar.fromGeoTIFF(t,e[0]),o=i.MallaEscalar.fromGeoTIFF(t,e[1]);return new MallaVectorial(MallaVectorial._paramsFromScalarFields(a,o))},MallaVectorial._paramsFromScalarFields=function(t,e){return{cellSize:t.cellSize,nCols:t.nCols,nRows:t.nRows,us:t.zs,vs:e.zs,xllCorner:t.xllCorner,yllCorner:t.yllCorner}},MallaVectorial.prototype.getScalarField=function(t){var e=this._getFunctionFor(t),a={cellSize:this.defMalla.cellSize,nCols:this.defMalla.nCols,nRows:this.defMalla.nRows,xllCorner:this.defMalla.xllCorner,yllCorner:this.defMalla.yllCorner,zs:this._applyOnField(e)};return new i.MallaEscalar(a)},MallaVectorial.prototype._buildGrid=function(){return this._arraysTo2d(this.us,this.vs,this.nRows,this.nCols)},MallaVectorial.prototype._calculateRange=function(){var t=this.getCells().map(function(t){return t.value}).filter(function(t){return null!==t});this._inFilter&&(t=t.filter(this._inFilter));var e=t.map(function(t){return t.magnitude()});return[r.min(e),r.max(e)]},MallaVectorial.prototype._doInterpolation=function(t,e,a,o,r,n){var i=1-t,s=1-e,c=i*s,u=t*s,p=i*e,f=t*e,h=a.u*c+o.u*u+r.u*p+n.u*f,d=a.v*c+o.v*u+r.v*p+n.v*f;return new l.Vector(h,d)},MallaVectorial.prototype._getFunctionFor=function(t){return function(e,a){var o=new l.Vector(e,a);return{directionFrom:o.directionFrom,directionTo:o.directionTo,magnitude:o.magnitude}[t]()}},MallaVectorial.prototype._applyOnField=function(t){for(var e=[],a=this.numCells(),o=0;o<a;o++){var r=this.us[o],n=this.vs[o];this._isValid(r)&&this._isValid(n)?e.push(t(r,n)):e.push(null)}return e},MallaVectorial.prototype._arraysTo2d=function(t,e,a,o){for(var r=[],n=0,i=0;i<a;i++){for(var s=[],c=0;c<o;c++,n++){var u=t[n],p=e[n],f=this._isValid(u)&&this._isValid(p);s[c]=f?new l.Vector(u,p):null}r[i]=s}return r},MallaVectorial}(n.Malla);e.MallaVectorial=s},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=a(15),n=a(0),i=a(16),l=a(2),s=a(6),c=function(t){function CanvasLayerMallaEscalar(e,a){var o=t.call(this,e,a)||this;return o._colorO=r.scale(i.ColorScale.scales("troposfera").colors).domain(o._malla.range),o._options={arrowDirection:"from",color:o._colorO,interpolate:!0,type:"colormap",vectorSize:20},n.Util.setOptions(o,a),o}return o(CanvasLayerMallaEscalar,t),CanvasLayerMallaEscalar.prototype.onDrawLayer=function(){if(this.isVisible()){this._updateOpacity();var t=this._getRendererMethod();console.time("onDrawLayer"),t(),console.timeEnd("onDrawLayer")}},CanvasLayerMallaEscalar.prototype.getColor=function(){return this.options.color},CanvasLayerMallaEscalar.prototype.setColor=function(t){this.options.color=t,this.needRedraw()},CanvasLayerMallaEscalar.prototype.getEvents=function(){var e=t.prototype.getEvents.call(this);return e.click=this._onClick,e},CanvasLayerMallaEscalar.prototype._showCanvas=function(){t.prototype._showCanvas.call(this),this.needRedraw()},CanvasLayerMallaEscalar.prototype._defaultColorScale=function(){return r.scale(["white","black"]).domain(this._malla.range)},CanvasLayerMallaEscalar.prototype._getRendererMethod=function(){switch(this.options.type){case"colormap":return this._drawImage.bind(this);case"vector":return this._drawArrows.bind(this);default:throw Error("Unkwown renderer type: "+this.options.type)}},CanvasLayerMallaEscalar.prototype._ensureColor=function(){null===this.options.color&&this.setColor(this._defaultColorScale())},CanvasLayerMallaEscalar.prototype._drawImage=function(){this._ensureColor();var t=this._getDrawingContext(),e=this._canvas.width,a=this._canvas.height,o=t.createImageData(e,a),r=o.data;this._prepareImageIn(r,e,a),t.putImageData(o,0,0)},CanvasLayerMallaEscalar.prototype._prepareImageIn=function(t,e,a){for(var o=0,r=0;r<a;r+=2)for(var n=0;n<e;n+=2){var i=this._map.containerPointToLatLng([n,r]),l=i.lng,s=i.lat,c=void 0;if(null!==(c=this.options.interpolate?this._malla.interpolatedValueAt(l,s):this._malla.valueAt(l,s))){o++;for(var u=this._getColorFor(c),p=u.rgba(),f=p[0],h=p[1],d=p[2],_=p[3],y=0;y<2&&y+n<e;y++)for(var v=0;v<2&&r+v<a;v++){var g=4*((r+v)*e+n+y);t[g]=f,t[g+1]=h,t[g+2]=d,t[g+3]=(255*_).toFixed(0)}}}},CanvasLayerMallaEscalar.prototype._drawArrows=function(){var t=this._pixelBounds(),e=(t.max.x-t.min.x)/this._malla.nCols,a=Math.max(1,Math.floor(1.2*this.options.vectorSize/e)),o=this._getDrawingContext();o.strokeStyle=this.options.color;for(var r=this._map.getBounds(),i=0;i<this._malla.height;i+=a)for(var s=0;s<this._malla.width;s+=a){var c=this._malla.lonLatAtIndexes(s,i),u=c[0],p=c[1],f=this._malla.valueAt(u,p),h=new n.LatLng(p,u);if(null!==f&&r.contains(h)){var d=new l.Celda(h,f,this._malla.cellSize);this._drawArrow(d,o)}}},CanvasLayerMallaEscalar.prototype._pixelBounds=function(){var t=this.getBounds(),e=this._map.latLngToContainerPoint(t.getNorthWest()),a=this._map.latLngToContainerPoint(t.getSouthEast());return n.bounds(e,a)},CanvasLayerMallaEscalar.prototype._drawArrow=function(t,e){var a=this._map.latLngToContainerPoint(t.center),o=this.options.color;"function"==typeof o&&(e.strokeStyle=o(t.value));var r=this.options.vectorSize;e.save(),e.translate(a.x,a.y);var n=(90+t.value)*Math.PI/180;"towards"===this.options.arrowDirection&&(n+=Math.PI),e.rotate(n),e.beginPath(),e.moveTo(-r/2,0),e.lineTo(+r/2,0),e.moveTo(.25*r,.25*-r),e.lineTo(+r/2,0),e.lineTo(.25*r,.25*r),e.stroke(),e.restore()},CanvasLayerMallaEscalar.prototype._getColorFor=function(t){var e=this.options.color;return"function"==typeof e&&(e=this.options.color(t)),r(e)},CanvasLayerMallaEscalar}(s.CanvasLayerMalla);e.CanvasLayerMallaEscalar=c},function(t,e){t.exports=o},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}(),r=this&&this.__assign||Object.assign||function(t){for(var e,a=1,o=arguments.length;a<o;a++){e=arguments[a];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t};Object.defineProperty(e,"__esModule",{value:!0});var n=a(0),i=function(t){function ColorScale(e,a){var o=t.call(this)||this;return o.options={clampHigh:!1,clampLow:!1,domain:[0,1],height:1,width:256},n.Util.setOptions(o,a),o.definition=ColorScale.buildFullDefinition(e),o._prepareScale(),o}return o(ColorScale,t),ColorScale.buildFullDefinition=function(t){var e;Array.isArray(t)?e.colors=t:e=ColorScale.scales(t);var a=e.colors.length,o=1/(a-1),r=[],n=0;do{r.push(n),n+=o}while(n<=1);return e.positions=r,e},ColorScale.scales=function(t){return{autumn:{colors:["#ff0000","#ffff00"],positions:[0,1]},blackbody:{colors:["#000000","#e60000","#e6d200","#ffffff","#a0c8ff"],positions:[0,.2,.4,.7,1]},bluered:{colors:["#0000ff","#ff0000"],positions:[0,1]},bone:{colors:["#000000","#545474","#a9c8c8","#ffffff"],positions:[0,.376,.753,1]},cool:{colors:["#00ffff","#ff00ff"],positions:[0,1]},copper:{colors:["#000000","#ffa066","#ffc77f"],positions:[0,.804,1]},earth:{colors:["#000082","#00b4b4","#28d228","#e6e632","#784614","#ffffff"],positions:[0,.1,.2,.4,.6,1]},electric:{colors:["#000000","#1e0064","#780064","#a05a00","#e6c800","#fffadc"],positions:[0,.15,.4,.6,.8,1]},greens:{colors:["#00441b","#006d2c","#238b45","#41ab5d","#74c476","#a1d99b","#c7e9c0","#e5f5e0","#f7fcf5"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]},greys:{colors:["#000000","#ffffff"],positions:[0,1]},hot:{colors:["#000000","#e60000","#ffd200","#ffffff"],positions:[0,.3,.6,1]},hsv:{colors:["#ff0000","#fdff02","#f7ff02","#00fc04","#00fc0a","#01f9ff","#0200fd","#0800fd","#ff00fb","#ff00f5","#ff0006"],positions:[0,.169,.173,.337,.341,.506,.671,.675,.839,.843,1]},jet:{colors:["#000083","#003CAA","#05FFFF","#FFFF00","#FA0000","#800000"],positions:[0,.125,.375,.625,.875,1]},picnic:{colors:["#0000ff","#3399ff","#66ccff","#99ccff","#ccccff","#ffffff","#ffccff","#ff99ff","#ff66cc","#ff6666","#ff0000"],positions:[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1]},portland:{colors:["#0c3383","#0a88ba","#f2d338","#f28f38","#d91e1e"],positions:[0,.25,.5,.75,1]},rainbow:{colors:["#96005A","#0000C8","#0019FF","#0098FF","#2CFF96","#97FF00","#FFEA00","#FF6F00","#FF0000"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]},rdbu:{colors:["#050aac","#6a89f7","#bebebe","#dcaa84","#e6915a","#b20a1c"],positions:[0,.35,.5,.6,.7,1]},spring:{colors:["#ff00ff","#ffff00"],positions:[0,1]},summer:{colors:["#008066","#ffff66"],positions:[0,1]},troposfera:{colors:["rgb(128,128,128)","rgb(79,9,207)","rgb(8,55,206)","rgb(8,184,216)","rgb(14,234,138)","rgb(20,229,9)","rgb(139,214,8)","rgb(248,193,26)","rgb(243,56,19)","rgb(219,9,103)"]},viridis:{colors:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"]},winter:{colors:["#0000ff","#00ff80"],positions:[0,1]},yignbu:{colors:["#081d58","#253494","#225ea8","#1d91c0","#41b6c4","#7fcdbb","#c7e9b4","#edf8d9","#ffffd9"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]},yiorrd:{colors:["#800026","#bd0026","#e31a1c","#fc4e2a","#fd8d3c","#feb24c","#fed976","#ffeda0","#ffffcc"],positions:[0,.125,.25,.375,.5,.625,.75,.875,1]}}[t.toLowerCase()]},ColorScale.rgbToHex=function(t,e,a){function _componentToHex(t){var e=t.toString(16);return 1===e.length?"0"+e:e}return"#"+[t,e,a].map(_componentToHex).join("")},ColorScale.hexToRgb=function(t){var e=t.slice(1),a=new ArrayBuffer(4);new DataView(a).setUint32(0,parseInt(e,16),!1);var o=new Uint8Array(a);return[o[1],o[2],o[3]]},ColorScale.prototype.setDomain=function(t){return this.options.domain=t,this},ColorScale.prototype.colorFor=function(t){var e=this.options.domain,a=e[0],o=e[1],r=o-a,n=Math.round((this.options.width-1)*((t-a)/r)),i=255;n<0&&(n=0,this.options.clampLow||(i=0)),n>this.options.width-1&&(n=this.options.width-1,this.options.clampHigh||(i=0));var l=i;return[this.csImageData[4*n],this.csImageData[4*n+1],this.csImageData[4*n+2],l]},ColorScale.prototype.flip=function(){var t=r({},this.definition);return t.colors=this.definition.colors.reverse(),new ColorScale(t,this.options)},ColorScale.prototype._prepareScale=function(){var t=this._createCanvas(),e=t.getContext("2d");this._createGradientIn(e),this.canvas=t,this.csImageData=e.getImageData(0,0,this.options.width,1).data},ColorScale.prototype._createCanvas=function(){var t=document.createElement("canvas");return t.width=this.options.width,t.height=this.options.height,t},ColorScale.prototype._createGradientIn=function(t){for(var e=t.createLinearGradient(0,0,this.options.width,0),a=this.definition,o=0;o<a.colors.length;++o)e.addColorStop(a.positions[o],a.colors[o]);t.fillStyle=e,t.fillRect(0,0,this.options.width,this.options.height)},ColorScale}(n.Class);e.ColorScale=i},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=a(18),n=a(0),i=a(6),l=function(t){function CanvasLayerMallaVectorial(e,a){var o=t.call(this,e,a)||this;return o._options={color:"grey",duration:40,fade:.97,maxAge:200,paths:1e3,velocityScale:.0025,width:1.2},n.Util.setOptions(o,a),o.timer=null,o}return o(CanvasLayerMallaVectorial,t),CanvasLayerMallaVectorial.prototype.onDrawLayer=function(t){var e=this;if(this._malla&&this.isVisible()){this._updateOpacity();var a=this._getDrawingContext(),o=this._prepareParticlePaths();this.timer=r.interval(function(){e._moveParticles(o),e._drawParticles(a,o,t)},this.options.duration)}},CanvasLayerMallaVectorial.prototype.onLayerWillUnmount=function(){t.prototype.onLayerWillUnmount.call(this),this._stopAnimation()},CanvasLayerMallaVectorial.prototype._hideCanvas=function(){t.prototype._hideCanvas.call(this),this._stopAnimation()},CanvasLayerMallaVectorial.prototype._drawParticle=function(t,e,a){var o=new n.LatLng(a.y,a.x),r=new n.LatLng(a.yt,a.xt);if(t.bounds.contains(o)&&a.age<=this.options.maxAge){var i=t.layer._map.latLngToContainerPoint(o),l=t.layer._map.latLngToContainerPoint(r);e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(l.x,l.y),a.x=a.xt,a.y=a.yt;var s=this.options.color;"function"==typeof s&&(e.strokeStyle=s(a.m));var c=this.options.width;"function"==typeof c&&(e.lineWidth=c(a.m)),e.stroke()}},CanvasLayerMallaVectorial.prototype._prepareParticlePaths=function(){for(var t=[],e=0;e<this.options.paths;e++){var a=this._malla.randomPosition();a.age=this._randomAge(),t.push(a)}return t},CanvasLayerMallaVectorial.prototype._randomAge=function(){return Math.floor(Math.random()*this.options.maxAge)},CanvasLayerMallaVectorial.prototype._moveParticles=function(t){var e=this;t.forEach(function(t){t.age>e.options.maxAge&&(t.age=0,e._malla.randomPosition(t));var a=e._malla.valueAt(t.x,t.y);if(null===a)t.age=e.options.maxAge;else{var o=t.x+a.u*e.options.velocityScale,r=t.y+a.v*e.options.velocityScale;e._malla.hasValueAt(o,r)?(t.xt=o,t.yt=r,t.m=a.magnitude()):t.age=e.options.maxAge}t.age+=1})},CanvasLayerMallaVectorial.prototype._drawParticles=function(t,e,a){var o=this,r=t.globalCompositeOperation;t.globalCompositeOperation="destination-in",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=r,t.fillStyle="rgba(0, 0, 0, "+this.options.fade+")",t.lineWidth=this.options.width,t.strokeStyle=this.options.color,e.forEach(function(e){e.age<o.options.maxAge&&o._drawParticle(a,t,e)})},CanvasLayerMallaVectorial.prototype._stopAnimation=function(){this.timer&&this.timer.stop()},CanvasLayerMallaVectorial}(i.CanvasLayerMalla);e.CanvasLayerMallaVectorial=l},function(t,e){t.exports=a},function(t,e,a){"use strict";var o=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])};return function(e,a){function __(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(__.prototype=a.prototype,new __)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=a(0),n=a(7),i=function(t){function CanvasLayerPuntosMalla(e,a){var o=t.call(this,a)||this;return o.options={color:"gray"},o.points=e,o}return o(CanvasLayerPuntosMalla,t),CanvasLayerPuntosMalla.prototype.setData=function(){this.needRedraw()},CanvasLayerPuntosMalla.prototype.onDrawLayer=function(t){var e=t.canvas.getContext("2d");e.clearRect(0,0,t.canvas.width,t.canvas.height),e.fillStyle=this.options.color;for(var a=0,o=this.points;a<o.length;a++){var r=o[a],n=t.layer._map.latLngToContainerPoint(r);e.beginPath(),e.fillRect(n.x,n.y,2,2),e.fill(),e.closePath(),e.stroke()}},CanvasLayerPuntosMalla.prototype.getBounds=function(){var t=this.points.map(function(t){return t.lng}),e=this.points.map(function(t){return t.lat}),a=Math.min.apply(Math,t),o=Math.min.apply(Math,e),n=Math.max.apply(Math,t),i=Math.max.apply(Math,e),l=new r.LatLng(o,a),s=new r.LatLng(i,n);return new r.LatLngBounds(l,s)},CanvasLayerPuntosMalla.prototype.onLayerDidMount=function(){},CanvasLayerPuntosMalla.prototype.onLayerWillUnmount=function(){},CanvasLayerPuntosMalla}(n.CanvasLayer);e.CanvasLayerPuntosMalla=i}])});